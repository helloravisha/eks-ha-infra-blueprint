
##  Affnity and AntiAffnity 

#### ‚úÖ Affinity: "Place the pod here, if the node matches the label."
#### üö´ Anti-Affinity: "Do not place the pod here, if the node has a matching label."

‚úåÔ∏è Note for Anti affinity - When a pod is initially scheduled on a node, anti-affinity rules do not apply to it (since it's the first pod), and it can be scheduled on any node. Only subsequent pods that are being scheduled are affected by the anti-affinity rules.

```
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchLabels:
            app: encode-service
        topologyKey: kubernetes.io/hostname
```

##### requiredDuringSchedulingIgnoredDuringExecution , preferredDuringSchedulingIgnoredDuringExecution 
 ‚úåÔ∏è <b>IgnoredDuringExecution</b> Applies when pod is scheduled and not while pod is running. <br>
 ‚úåÔ∏è <b>requiredDuringScheduling</b> - mandatory for scheduling  , <b>preferredDuringScheduling</b> - not mandatory for scheduling 

##### topologyKey - Tells which domain to consider 
 ‚úåÔ∏è Host, AZ, Region , Data Center etc. 
  
## Taints and Tolerations 

```
spec:
  tolerations:
    - key: "critical"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"
```

The real difference between `NoSchedule`, `PreferNoSchedule`, and `NoExecute` only shows up **when the pod does not have a matching toleration**.

#### üü• NoSchedule
- **No toleration?** ‚Üí üö´ Pod will **never** be scheduled on that node.
- **With toleration?** ‚Üí ‚úÖ scheduled.

#### üüß PreferNoSchedule
- **No toleration?** ‚Üí üòï Scheduler **tries to avoid** this node, but **may schedule** it anyway if no better options.
- **With toleration?** ‚Üí ‚úÖ scheduled.

#### ‚¨õ NoExecute
- **No toleration?** ‚Üí üö´ Pod will be **evicted** from the node if it's already running there and will not be scheduled there again.
- **With toleration?** ‚Üí ‚úÖ scheduled.

> üí° You can even say: ‚ÄúStay for 60 seconds and then get evicted‚Äù using `tolerationSeconds`.

### topologySpreadConstraints
#### while Taints / Tolerations  and Affinity /Anti Affinity Talks about Node Suitability and Pod to Pod Relationship  , topologySpreadConstraints talks about distribution of pods across zones and regions 

```
topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: topology.kubernetes.io/zone
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: encode-service
```






 
